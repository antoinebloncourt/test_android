<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Document sans nom</title>
	<script src="phonegap.js"></script>
	<script type="text/javascript" charset="utf-8">
    
    document.addEventListener("deviceready", onDeviceReady, false);
    
    // PhoneGap is ready
    //
    function onDeviceReady() {
        window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFileSystemSuccess, fail);
    }
    
    function onFileSystemSuccess(fileSystem) {
        fileSystem.root.getDirectory("/sdcard/Download", {create: false, exclusive: false}, getDirSuccess, fail);
    }
    
    function getDirSuccess(dirEntry) {
        // Get a directory reader
        var directoryReader = dirEntry.createReader();
    
        // Get a list of all the entries in the directory
        directoryReader.readEntries(readerSuccess,fail);
    }
    
    var numDirs = 0;
    var numFiles = 0;
    
    // create timeout var outside your "readerSuccess" function scope
    var readerTimeout = null, millisecondsBetweenReadSuccess = 100;
    
    function readerSuccess(entries) {
        var i = 0, len = entries.length;
        for (; i < len; i++) {
            if (entries[i].isFile) {
                numFiles++;
                entries[i].file(fileSuccess,fail);
            } else if (entries[i].isDirectory) {
                numDirs++;
                getDirSuccess(entries[i]);
            }
            if (readerTimeout) {
                window.clearTimeout(readerTimeout);
            }
        }
        if (readerTimeout) {
            window.clearTimeout(readerTimeout);
        }
        readerTimeout = window.setTimeout(weAreDone, millisecondsBetweenReadSuccess);
    }
    
    // additional event to call when totally done
    function weAreDone() {
       alert("ok");
    }
    
    
  </script>
</head>
<body>
  <input type="button" onClick="doDirectoryListing();" value="test">
</body>
</html>
